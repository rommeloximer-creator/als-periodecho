<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALS PeriodECHO - SDO Pangasinan II</title>
    <meta name="description" content="Our Voice, Our Story, Our Journey. The official digital platform for ALS SDO Pangasinan II.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:ital,wght@0,300;0,700;0,900;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, setDoc, updateDoc, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyCgvnHGxu_G5euXHrIoov07GxS08CtvG4Y",
            authDomain: "als-periodecho.firebaseapp.com",
            projectId: "als-periodecho",
            storageBucket: "als-periodecho.firebasestorage.app",
            messagingSenderId: "969937604443",
            appId: "1:969937604443:web:fead3fe0aa71a6f2d7147e"
        };

        const appId = new URLSearchParams(window.location.search).get('appId') || 'default-als-app';
        let app, auth, db;
        
        try {
            const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
            app = initializeApp(config);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) { console.error("Firebase init error", e); }

        const appIdentifier = typeof __app_id !== 'undefined' ? __app_id : appId;
        
        // --- Global State ---
        let currentUser = null;
        let articles = [];
        let siteSettings = { 
            logoUrl: null, bannerUrl: null, title: 'PeriodECHO', subtitle: 'SDO Pangasinan II', tagline: '', 
            brandingType: 'banner', useStaticHero: true, heroUrl: null, heroDescription: 'Your digital platform.',
            facebookUrl: '', twitterUrl: '', instagramUrl: ''
        }; 
        let isAdminMode = false;
        
        // Gallery & Form State
        let editingArticleId = null;
        let currentArticleImages = []; 
        let viewerImages = [];
        let viewerIndex = 0;

        // --- Initialization ---
        async function initApp() {
            // Check Admin Mode
            if (localStorage.getItem("isLoggedIn") === "true") {
                isAdminMode = true;
                setTimeout(() => {
                    const adminSec = document.getElementById('admin-section');
                    const homeSec = document.getElementById('home-section');
                    const heroSec = document.getElementById('hero-section');
                    const controls = document.getElementById('admin-controls');
                    const loginLink = document.getElementById('footer-login-link');

                    if(adminSec) adminSec.classList.remove('hidden');
                    if(homeSec) homeSec.classList.add('hidden');
                    if(heroSec) heroSec.classList.add('hidden');
                    if(controls) controls.style.display = 'inline';
                    if(loginLink) loginLink.style.display = 'none';
                }, 500); 
            }

            if (!auth) return;
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                   await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                   await signInAnonymously(auth);
                }
            } catch (error) { console.error("Auth Failed", error); }

            onAuthStateChanged(auth, (user) => {
                if (user) { currentUser = user; setupListeners(); }
            });
        }

        function setupListeners() {
            if (!currentUser || !db) return;
            
            // Articles Listener
            const qArticles = collection(db, 'artifacts', appIdentifier, 'public', 'data', 'articles');
            onSnapshot(qArticles, (snapshot) => {
                articles = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                articles.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                updateHeroSection();
                renderHomeFeed(); 
                if (isAdminMode) renderAdminDashboard();
            });

            // Settings Listener
            const docSettings = doc(db, 'artifacts', appIdentifier, 'public', 'data', 'settings', 'site_config');
            onSnapshot(docSettings, (docSnap) => {
                if (docSnap.exists()) {
                    siteSettings = { ...siteSettings, ...docSnap.data() };
                    renderBranding();
                    updateHeroSection();
                    renderHomeFeed();
                    updateSocialLinks();
                }
            });
        }

        // --- Rendering Logic ---
        function renderBranding() {
            const container = document.getElementById('navbar-brand-area');
            if (siteSettings.brandingType === 'banner' && siteSettings.bannerUrl) {
                container.innerHTML = `<div class="h-20 md:h-32 flex items-center justify-center overflow-hidden w-full bg-white border-b border-slate-200 pt-4 px-4"><img src="${siteSettings.bannerUrl}" class="h-full w-auto object-contain max-w-full"></div>`;
            } else {
                const logoHtml = siteSettings.logoUrl ? `<img src="${siteSettings.logoUrl}" class="w-10 h-10 rounded-full object-cover border-2 border-als-yellow shadow-lg">` : `<div class="w-10 h-10 rounded-full bg-gradient-to-br from-als-teal to-als-navy flex items-center justify-center text-white font-bold border-2 border-als-yellow shadow-lg"><span class="text-xs">ALS</span></div>`;
                container.innerHTML = `<div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()"><div class="site-logo-container">${logoHtml}</div><div class="flex flex-col justify-center"><span class="brand-title-text font-serif font-black text-xl tracking-tight text-als-navy dark:text-als-tealLight leading-none">${siteSettings.title || 'PeriodECHO'}</span><span class="brand-subtitle-text text-[10px] uppercase tracking-widest font-semibold text-slate-500 dark:text-slate-400 leading-tight">${siteSettings.subtitle || 'SDO Pangasinan II'}</span></div></div>`;
            }
        }

        function updateSocialLinks() {
            const fbLink = document.getElementById('footer-fb');
            const twLink = document.getElementById('footer-tw');
            const igLink = document.getElementById('footer-ig');
            if(fbLink) { fbLink.href = siteSettings.facebookUrl || '#'; fbLink.classList.toggle('hidden', !siteSettings.facebookUrl); }
            if(twLink) { twLink.href = siteSettings.twitterUrl || '#'; twLink.classList.toggle('hidden', !siteSettings.twitterUrl); }
            if(igLink) { igLink.href = siteSettings.instagramUrl || '#'; igLink.classList.toggle('hidden', !siteSettings.instagramUrl); }
        }

        function updateHeroSection() {
            const heroTitle = document.getElementById('hero-title');
            const heroExcerpt = document.getElementById('hero-excerpt');
            const heroImg = document.getElementById('hero-image');
            const heroBtn = document.getElementById('hero-read-btn');
            const heroBadge = document.getElementById('hero-badge');

            if (siteSettings.useStaticHero) {
                heroBadge.textContent = "WELCOME";
                heroTitle.textContent = "Welcome to " + (siteSettings.title || 'ALS PeriodECHO');
                heroExcerpt.textContent = siteSettings.heroDescription || 'Your digital platform.';
                heroImg.src = siteSettings.heroUrl || "https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80";
                heroBtn.textContent = "Browse News";
                heroBtn.onclick = () => document.getElementById('home-section').scrollIntoView({behavior: 'smooth'});
            } else if (articles.length > 0) {
                const article = articles[0];
                heroBadge.textContent = "FEATURED STORY";
                heroTitle.textContent = article.title;
                heroExcerpt.textContent = article.excerpt || article.content.substring(0, 150) + '...';
                heroImg.src = article.imageUrl || (article.images && article.images[0]) || '';
                heroBtn.textContent = "Read Story";
                heroBtn.onclick = () => window.viewArticle(article.id);
            }
        }

        window.filterArticles = () => {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = articles.filter(a => a.title.toLowerCase().includes(query) || (a.content && a.content.toLowerCase().includes(query)) || (a.category && a.category.toLowerCase().includes(query)));
            renderHomeFeed(filtered, !!query);
        }

        function renderHomeFeed(dataSource = null, isSearching = false) {
            const container = document.getElementById('news-grid');
            container.innerHTML = '';
            let gridArticles = (dataSource || articles);
            if (!isSearching && !siteSettings.useStaticHero) gridArticles = gridArticles.slice(1);

            if (gridArticles.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-300"><p class="text-slate-500">No stories found.</p></div>`;
                return;
            }

            gridArticles.forEach(article => {
                const card = document.createElement('article');
                card.className = "article-card bg-white dark:bg-slate-800 rounded-xl shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-slate-100 dark:border-slate-700 flex flex-col group";
                const imgUrl = article.imageUrl || (article.images && article.images[0]) || `https://ui-avatars.com/api/?name=${encodeURIComponent(article.title)}&background=0e7490&color=fff&size=512`;
                
                card.innerHTML = `
                    <div class="h-48 overflow-hidden relative">
                        <img src="${imgUrl}" onerror="this.src='https://placehold.co/600x400'" class="card-image w-full h-full object-cover group-hover:scale-105">
                    </div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="mb-3"><span class="inline-block bg-als-yellow text-als-navy text-xs font-bold px-2 py-1 rounded shadow">${article.category || 'News'}</span></div>
                        <h4 class="font-serif text-xl font-bold mb-3 text-als-navy dark:text-slate-100 group-hover:text-als-teal line-clamp-2">${article.title}</h4>
                        <p class="text-slate-600 dark:text-slate-400 text-sm mb-4 line-clamp-3 flex-1">${article.excerpt || article.content.substring(0, 100) + '...'}</p>
                        <div class="pt-4 border-t border-slate-100 dark:border-slate-700 mt-auto flex justify-between items-center">
                             <span class="text-xs text-slate-500 italic">${new Date(article.createdAt?.seconds * 1000).toLocaleDateString() || 'Just now'}</span>
                             <button onclick="window.viewArticle('${article.id}')" class="text-als-teal hover:text-als-orange text-sm font-bold">Read <i class="fas fa-arrow-right ml-1"></i></button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderAdminDashboard() {
            const listContainer = document.getElementById('admin-list-container');
            listContainer.innerHTML = '';
            articles.forEach(article => {
                const item = document.createElement('div');
                item.className = "flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600";
                const imgUrl = article.imageUrl || (article.images && article.images[0]) || 'https://placehold.co/100';
                item.innerHTML = `
                    <div class="flex items-center space-x-4">
                         <div class="w-12 h-12 bg-slate-200 rounded overflow-hidden flex-shrink-0"><img src="${imgUrl}" class="w-full h-full object-cover"></div>
                         <div><h4 class="font-bold text-slate-800 dark:text-white line-clamp-1">${article.title}</h4><p class="text-xs text-slate-500">${article.category || 'News'}</p></div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="window.editArticle('${article.id}')" class="p-2 text-blue-500 hover:bg-blue-50 rounded"><i class="fas fa-pen"></i></button>
                        <button onclick="window.deleteArticle('${article.id}')" class="p-2 text-red-500 hover:bg-red-50 rounded"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // --- Multi-Image Logic (Gallery Manager) ---
        window.renderImageManager = () => {
            const container = document.getElementById('image-manager-list');
            if(!container) return; 
            container.innerHTML = '';
            
            if (typeof currentArticleImages === 'undefined') window.currentArticleImages = [];

            currentArticleImages.forEach((url, index) => {
                const div = document.createElement('div');
                div.className = "relative group aspect-square bg-slate-100 rounded overflow-hidden border border-slate-200 shadow-sm";
                div.innerHTML = `
                    <img src="${url}" class="w-full h-full object-cover">
                    <button type="button" onclick="window.removeImage(${index})" class="absolute top-1 right-1 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-xs shadow-md transition-transform transform hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                    ${index === 0 ? '<span class="absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] text-center py-1 font-bold tracking-wide">COVER</span>' : ''}
                `;
                container.appendChild(div);
            });
        }

        window.handleAddImage = () => {
            if (typeof currentArticleImages === 'undefined') window.currentArticleImages = [];
            
            // Get message element reference
            const msg = document.getElementById('image-limit-msg');
            
            // Global check: if already full
            if (currentArticleImages.length >= 4) {
                if(msg) { msg.classList.remove('hidden'); msg.textContent = "Max 4 images allowed."; }
                return;
            }

            const source = document.querySelector('input[name="post-img-source"]:checked').value;

            if (source === 'url') {
                const input = document.getElementById('post-img-input-url');
                if(input.value.trim()) {
                    currentArticleImages.push(input.value.trim());
                    input.value = ""; 
                    renderImageManager();
                    if(msg) msg.classList.add('hidden');
                }
            } else {
                const input = document.getElementById('post-img-input-file');
                if (input.files && input.files.length > 0) {
                    
                    // Check if new files fit into remaining slots
                    const slotsLeft = 4 - currentArticleImages.length;
                    if (input.files.length > slotsLeft) {
                        if(msg) { 
                            msg.classList.remove('hidden'); 
                            msg.textContent = `You selected ${input.files.length} images, but only have ${slotsLeft} slot(s) left.`; 
                        }
                        return;
                    }

                    // Process ALL selected files
                    Array.from(input.files).forEach(file => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                const ctx = canvas.getContext('2d');
                                const MAX_WIDTH = 800; 
                                let width = img.width; let height = img.height;
                                if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                                canvas.width = width; canvas.height = height;
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                currentArticleImages.push(canvas.toDataURL('image/jpeg', 0.8)); 
                                renderImageManager();
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    });
                    
                    input.value = ""; // Clear input after processing
                    if(msg) msg.classList.add('hidden');
                }
            }
        }

        window.removeImage = (index) => {
            currentArticleImages.splice(index, 1);
            renderImageManager();
        }

        // --- Slideshow & Viewer Logic ---
        window.changeSlide = (direction) => {
            if (typeof viewerImages === 'undefined' || viewerImages.length <= 1) return;
            
            viewerIndex += direction;
            if (viewerIndex >= viewerImages.length) viewerIndex = 0;
            if (viewerIndex < 0) viewerIndex = viewerImages.length - 1;

            const img = document.getElementById('modal-img');
            img.style.opacity = '0'; 
            setTimeout(() => {
                img.src = viewerImages[viewerIndex];
                img.style.opacity = '1';
                const counter = document.getElementById('modal-img-counter');
                if(counter) counter.textContent = `${viewerIndex + 1} / ${viewerImages.length}`;
            }, 200);
        }

        window.viewArticle = (id) => {
            const article = articles.find(a => a.id === id);
            if (!article) return;
            
            // 1. Setup Images
            window.viewerIndex = 0;
            window.viewerImages = []; 
            if (article.images && Array.isArray(article.images) && article.images.length > 0) {
                window.viewerImages = article.images;
            } else {
                window.viewerImages = [article.imageUrl || ''];
            }

            // 2. Setup Slideshow
            const prevBtn = document.getElementById('modal-prev-btn');
            const nextBtn = document.getElementById('modal-next-btn');
            const counter = document.getElementById('modal-img-counter');
            const img = document.getElementById('modal-img');

            img.src = window.viewerImages[0];

            if (window.viewerImages.length > 1) {
                if(prevBtn) prevBtn.classList.remove('hidden');
                if(nextBtn) nextBtn.classList.remove('hidden');
                if(counter) {
                    counter.classList.remove('hidden');
                    counter.textContent = `1 / ${window.viewerImages.length}`;
                }
            } else {
                if(prevBtn) prevBtn.classList.add('hidden');
                if(nextBtn) nextBtn.classList.add('hidden');
                if(counter) counter.classList.add('hidden');
            }

            // 3. Setup Like Button
            const likeBtn = document.getElementById('like-btn');
            if(likeBtn) {
                const likeIcon = likeBtn.querySelector('i');
                const likeCount = document.getElementById('like-count');
                
                likeBtn.disabled = false;
                likeBtn.onclick = () => window.toggleLike(article.id);
                likeIcon.className = "far fa-heart text-xl text-slate-400 group-hover:text-red-500 transition-colors";
                likeCount.innerText = article.likes || 0;

                if (localStorage.getItem(`liked_${article.id}`)) {
                    likeIcon.classList.remove('far');
                    likeIcon.classList.add('fas', 'text-red-500');
                    likeBtn.classList.add('opacity-75');
                }
            }

            // 4. Fill Content
            document.getElementById('modal-title').textContent = article.title;
            document.getElementById('modal-category').textContent = article.category || 'News';
            document.getElementById('modal-date').textContent = new Date(article.createdAt?.seconds * 1000).toLocaleDateString() || '';
            document.getElementById('modal-content').innerHTML = article.content.split('\n').map(p => p.trim() ? `<p class="mb-4">${p}</p>` : '').join('');
            
            document.getElementById('article-modal').classList.remove('hidden');
        }

        window.closeModal = () => document.getElementById('article-modal').classList.add('hidden');

        // --- Like Logic ---
        window.toggleLike = async (id) => {
            const btn = document.getElementById('like-btn');
            const icon = btn.querySelector('i');
            const countSpan = document.getElementById('like-count');
            const storageKey = `liked_${id}`;
            
            if (localStorage.getItem(storageKey)) {
                showToast("You already liked this!", "error"); return;
            }
            
            icon.classList.remove('far'); icon.classList.add('fas', 'text-red-500'); btn.disabled = true;
            try {
                const docRef = doc(db, 'artifacts', appIdentifier, 'public', 'data', 'articles', id);
                await updateDoc(docRef, { likes: increment(1) });
                localStorage.setItem(storageKey, "true");
                let currentCount = parseInt(countSpan.innerText || "0");
                countSpan.innerText = currentCount + 1;
            } catch (e) { console.error(e); }
        }

        // --- Form Submission ---
        window.submitPost = async (event) => {
            event.preventDefault();
            const btn = event.target.querySelector('button[type="submit"]');
            const originalText = btn.textContent;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...'; btn.disabled = true;
            try {
                const data = {
                    title: document.getElementById('post-title').value,
                    category: document.getElementById('post-category').value,
                    excerpt: document.getElementById('post-excerpt').value,
                    content: document.getElementById('post-content').value,
                    images: window.currentArticleImages || [],
                    imageUrl: (window.currentArticleImages && window.currentArticleImages.length > 0) ? window.currentArticleImages[0] : null,
                    updatedAt: serverTimestamp()
                };

                if (editingArticleId) {
                    const docRef = doc(db, 'artifacts', appIdentifier, 'public', 'data', 'articles', editingArticleId);
                    await updateDoc(docRef, data);
                    showToast("Story Updated!");
                } else {
                    data.createdAt = serverTimestamp();
                    data.likes = 0; 
                    const colRef = collection(db, 'artifacts', appIdentifier, 'public', 'data', 'articles');
                    await addDoc(colRef, data);
                    showToast("Published!");
                }
                window.closePostForm();
            } catch (err) { console.error(err); showToast("Error saving", "error"); } 
            finally { btn.innerHTML = originalText; btn.disabled = false; }
        }

        // --- Helper Functions ---
        window.openPostForm = () => {
            editingArticleId = null; 
            document.getElementById('form-modal-title').textContent = "Write New Story";
            document.getElementById('form-submit-btn').textContent = "Publish Story";
            document.getElementById('new-post-form').reset();
            window.currentArticleImages = []; // Reset
            window.renderImageManager();
            document.querySelector('input[name="post-img-source"][value="url"]').click();
            document.getElementById('post-form-modal').classList.remove('hidden');
        }

        window.editArticle = (id) => {
            const article = articles.find(a => a.id === id);
            if (!article) return;
            editingArticleId = id; 
            document.getElementById('form-modal-title').textContent = "Edit Story";
            document.getElementById('form-submit-btn').textContent = "Update Story";
            document.getElementById('post-title').value = article.title;
            document.getElementById('post-category').value = article.category;
            document.getElementById('post-excerpt').value = article.excerpt;
            document.getElementById('post-content').value = article.content;
            
            if (article.images && Array.isArray(article.images)) {
                window.currentArticleImages = article.images;
            } else if (article.imageUrl) {
                window.currentArticleImages = [article.imageUrl];
            } else {
                window.currentArticleImages = [];
            }
            window.renderImageManager();
            document.querySelector('input[name="post-img-source"][value="url"]').click();
            document.getElementById('post-form-modal').classList.remove('hidden');
        }

        window.closePostForm = () => {
            document.getElementById('post-form-modal').classList.add('hidden');
            document.getElementById('new-post-form').reset();
            editingArticleId = null;
        }

        window.openBrandingForm = () => {
            document.getElementById('brand-title-input').value = siteSettings.title || '';
            document.getElementById('brand-subtitle-input').value = siteSettings.subtitle || '';
            document.getElementById('brand-tagline-input').value = siteSettings.tagline || '';
            document.getElementById('brand-hero-desc').value = siteSettings.heroDescription || '';
            document.getElementById('brand-fb-input').value = siteSettings.facebookUrl || '';
            document.getElementById('brand-tw-input').value = siteSettings.twitterUrl || '';
            document.getElementById('brand-ig-input').value = siteSettings.instagramUrl || '';

            const type = siteSettings.brandingType || 'standard';
            if (type === 'banner') document.getElementById('brand-type-banner').checked = true;
            else document.getElementById('brand-type-standard').checked = true;
            document.getElementById('brand-static-hero').checked = siteSettings.useStaticHero || false;
            
            toggleBrandingInputs();
            toggleHeroInputs();
            document.getElementById('branding-form-modal').classList.remove('hidden');
        }
        
        window.closeBrandingForm = () => {
            document.getElementById('branding-form-modal').classList.add('hidden');
            window.toggleImageSource('url', 'logo');
            window.toggleImageSource('url', 'banner');
            window.toggleImageSource('url', 'hero');
        }

        window.toggleBrandingInputs = () => {
            const isBanner = document.getElementById('brand-type-banner').checked;
            const standardSection = document.getElementById('branding-standard-section');
            const bannerSection = document.getElementById('branding-banner-section');
            if (isBanner) { standardSection.classList.add('hidden'); bannerSection.classList.remove('hidden'); } 
            else { standardSection.classList.remove('hidden'); bannerSection.classList.add('hidden'); }
        }

        window.toggleHeroInputs = () => {
            const isStatic = document.getElementById('brand-static-hero').checked;
            const heroSection = document.getElementById('branding-hero-section');
            if (isStatic) heroSection.classList.remove('opacity-50', 'pointer-events-none');
            else heroSection.classList.add('opacity-50', 'pointer-events-none');
        }

        window.submitBranding = async (event) => {
            event.preventDefault();
            const btn = event.target.querySelector('button[type="submit"]');
            btn.innerHTML = 'Saving...'; btn.disabled = true;
            const isBanner = document.getElementById('brand-type-banner').checked;
            const isStaticHero = document.getElementById('brand-static-hero').checked;
            const newData = {
                brandingType: isBanner ? 'banner' : 'standard',
                useStaticHero: isStaticHero,
                title: document.getElementById('brand-title-input').value,
                subtitle: document.getElementById('brand-subtitle-input').value,
                tagline: document.getElementById('brand-tagline-input').value,
                heroDescription: document.getElementById('brand-hero-desc').value,
                logoUrl: document.getElementById('logo-image').value || siteSettings.logoUrl,
                bannerUrl: document.getElementById('banner-image').value || siteSettings.bannerUrl,
                heroUrl: document.getElementById('hero-image-input').value || siteSettings.heroUrl,
                facebookUrl: document.getElementById('brand-fb-input').value,
                twitterUrl: document.getElementById('brand-tw-input').value,
                instagramUrl: document.getElementById('brand-ig-input').value
            };
            try {
                const docRef = doc(db, 'artifacts', appIdentifier, 'public', 'data', 'settings', 'site_config');
                await setDoc(docRef, newData, { merge: true });
                showToast("Branding Updated!");
                window.closeBrandingForm();
            } catch (err) { console.error(err); showToast("Error saving", "error"); }
            finally { btn.innerHTML = 'Save Changes'; btn.disabled = false; }
        }

        window.toggleImageSource = (source, type) => {
            const prefix = type;
            const urlInput = document.getElementById(`${prefix}-img-input-url`);
            const dropZone = document.getElementById(`${prefix}-drop-zone`);
            
            // Post form inputs handled by handleAddImage logic, so we skip them here
            if(type === 'post') {
                 const urlIn = document.getElementById('post-img-input-url');
                 const fileIn = document.getElementById('post-img-input-file');
                 if(source === 'url') {
                     urlIn.classList.remove('hidden');
                     fileIn.classList.add('hidden');
                 } else {
                     urlIn.classList.add('hidden');
                     fileIn.classList.remove('hidden');
                 }
                 return;
            }

            if(source === 'url') {
                urlInput.classList.remove('hidden');
                if(dropZone) dropZone.classList.add('hidden');
                const targetId = prefix === 'logo' ? 'logo-image' : (prefix === 'banner' ? 'banner-image' : 'hero-image-input');
                document.getElementById(targetId).value = urlInput.value;
            } else {
                urlInput.classList.add('hidden');
                if(dropZone) dropZone.classList.remove('hidden');
            }
        }
        
        window.updateUrlValue = (input, targetId) => {
            document.getElementById(targetId).value = input.value;
        }

        window.processImageUpload = (input, targetId) => {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 1200; 
                        let width = img.width; let height = img.height;
                        if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                        canvas.width = width; canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        if(targetId === 'post-image') {
                            if (typeof window.currentArticleImages === 'undefined') window.currentArticleImages = [];
                            window.currentArticleImages.push(canvas.toDataURL('image/jpeg', 0.8));
                            input.value = ""; 
                            window.renderImageManager();
                        } else {
                            document.getElementById(targetId).value = canvas.toDataURL('image/jpeg', 0.8);
                        }
                        showToast("Image processed!");
                        const parent = input.parentElement;
                        if(parent.id.includes('drop-zone')) {
                            parent.classList.add('border-als-teal', 'bg-slate-50');
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        window.handleDragOver = (e) => { e.preventDefault(); e.currentTarget.classList.add('border-als-teal', 'bg-slate-50'); }
        window.handleDragLeave = (e) => { e.preventDefault(); e.currentTarget.classList.remove('border-als-teal', 'bg-slate-50'); }
        window.handleDrop = (e, inputId, targetId) => {
            e.preventDefault();
            const dropZone = e.currentTarget;
            dropZone.classList.remove('border-als-teal', 'bg-slate-50');
            const fileInput = document.getElementById(inputId);
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                processImageUpload(fileInput, targetId);
            }
        }

        window.deleteArticle = async (id) => {
            if(confirm("Delete this story?")) {
                try {
                    await deleteDoc(doc(db, 'artifacts', appIdentifier, 'public', 'data', 'articles', id));
                    showToast("Deleted");
                } catch(e) { showToast("Error", "error"); }
            }
        }

        function showToast(msg, type = 'success') {
            const t = document.createElement('div');
            t.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg text-white shadow-xl z-50 ${type === 'success' ? 'bg-als-teal' : 'bg-red-500'}`;
            t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        window.toggleAdmin = () => {
             isAdminMode = false;
             localStorage.removeItem("isLoggedIn");
             window.location.reload();
        }

        initApp();
    </script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { als: { navy: '#0f172a', teal: '#0e7490', tealLight: '#22d3ee', yellow: '#fbbf24', orange: '#f97316' } }, fontFamily: { serif: ['Merriweather', 'serif'], sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <style>.card-image { transition: transform 0.5s ease; } .article-card:hover .card-image { transform: scale(1.05); }</style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 font-sans antialiased selection:bg-als-yellow selection:text-als-navy flex flex-col min-h-screen">

    <nav class="sticky top-0 z-40 bg-white/95 dark:bg-als-navy/95 backdrop-blur-sm border-b border-slate-200 dark:border-slate-700 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-20">
                <div id="navbar-brand-area" class="flex-1 flex items-center"></div>
                <button onclick="document.documentElement.classList.toggle('dark')" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-als-navy dark:text-als-yellow ml-4">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
            </div>
        </div>
    </nav>

    <header id="hero-section" class="relative bg-als-navy text-white overflow-hidden min-h-[400px] flex items-center">
        <div class="absolute inset-0 opacity-20 pointer-events-none"><svg class="h-full w-full" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0 100 C 20 0 50 0 100 100 Z" fill="#0e7490" /></svg></div>
        <div class="container mx-auto px-4 py-12 relative z-10 flex flex-col md:flex-row items-center gap-12">
            <div class="md:w-1/2 text-center md:text-left">
                <span id="hero-badge" class="inline-block py-1 px-3 rounded-full bg-als-yellow/20 text-als-yellow border border-als-yellow/50 text-xs font-bold tracking-wider mb-6">FEATURED STORY</span>
                <h1 id="hero-title" class="font-serif text-3xl sm:text-4xl md:text-5xl font-bold leading-tight mb-4 text-white">Welcome to ALS PeriodECHO</h1>
                <p id="hero-tagline" class="text-xl sm:text-2xl italic text-als-yellow font-serif mb-6 hidden">"Our Voice, Our Story, Our Journey"</p>
                <p id="hero-excerpt" class="text-lg text-slate-300 mb-8 max-w-xl font-light">Your digital platform for news, stories, and updates from the Alternative Learning System community.</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                    <button id="hero-read-btn" class="px-8 py-3 bg-als-yellow text-als-navy font-bold rounded-full hover:bg-white transition-colors shadow-lg">Read Story</button>
                </div>
            </div>
            <div class="md:w-1/2 w-full">
                <div class="rounded-2xl overflow-hidden shadow-2xl border-4 border-white/10 aspect-video relative bg-slate-800">
                    <img id="hero-image" src="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" class="w-full h-full object-cover">
                </div>
            </div>
        </div>
    </header>

    <main id="home-section" class="flex-grow container mx-auto px-4 py-12">
        <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
            <h3 class="text-2xl font-serif font-bold text-als-navy dark:text-white">Latest Updates</h3>
            <div class="relative w-full max-w-xs">
                <input type="text" id="search-input" oninput="window.filterArticles()" placeholder="Search stories..." class="w-full px-4 py-2 pl-10 rounded-full border border-slate-300 dark:border-slate-600 dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-als-teal focus:outline-none">
                <i class="fas fa-search absolute left-4 top-3 text-slate-400"></i>
            </div>
        </div>
        <div id="news-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
            <div class="animate-pulse bg-slate-200 h-64 rounded-xl"></div>
        </div>
    </main>

    <section id="admin-section" class="hidden container mx-auto px-4 py-12 flex-grow">
        <div class="flex justify-between items-center mb-8 border-b border-slate-200 pb-4">
            <h2 class="text-3xl font-bold text-als-navy dark:text-white">Admin Dashboard</h2>
            <div class="flex gap-4"><button onclick="window.toggleAdmin()" class="text-slate-500 hover:text-red-500">Exit Admin</button></div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-lg mb-4 dark:text-white">Site Branding</h3>
                    <p class="text-xs text-slate-500 mb-4">Edit header, welcome image, and titles.</p>
                    <button onclick="window.openBrandingForm()" class="w-full py-2 border border-als-teal text-als-teal hover:bg-als-teal hover:text-white rounded-lg transition-colors font-semibold text-sm">Update Branding</button>
                </div>
                <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-lg mb-4 dark:text-white">Account</h3>
                    <p class="text-xs text-slate-500 mb-4">Manage your admin credentials.</p>
                    <button onclick="window.changePassword()" class="w-full py-2 border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors font-semibold text-sm"><i class="fas fa-key mr-2"></i> Change Password</button>
                </div>
                <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-lg mb-4 dark:text-white">Quick Tips</h3>
                    <ul class="text-sm text-slate-600 dark:text-slate-400 space-y-3 list-disc pl-4">
                        <li>Use "Static Welcome" to set a permanent image on the home page.</li>
                        <li>Otherwise, the latest story image will appear there.</li>
                    </ul>
                </div>
            </div>
            <div class="lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg dark:text-white">Manage Posts</h3>
                    <button onclick="window.openPostForm()" class="bg-als-teal hover:bg-als-navy text-white px-4 py-2 rounded-full font-bold shadow-md text-sm"><i class="fas fa-plus mr-2"></i> New Story</button>
                </div>
                <div id="admin-list-container" class="space-y-4"></div>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 text-slate-300 py-12 mt-auto">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
            <div>
                <h4 class="text-white font-bold mb-4 uppercase text-xs tracking-wider">Connect With Us</h4>
                <div class="flex justify-center md:justify-start space-x-4">
                    <a id="footer-fb" href="#" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-als-teal hover:text-white transition-colors"><i class="fab fa-facebook-f"></i></a>
                    <a id="footer-tw" href="#" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-als-teal hover:text-white transition-colors hidden"><i class="fab fa-twitter"></i></a>
                    <a id="footer-ig" href="#" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-als-teal hover:text-white transition-colors hidden"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4 uppercase text-xs tracking-wider">Contact</h4>
                <p class="text-sm">SDO Pangasinan II Office<br>Binalonan, Pangasinan</p>
            </div>
            <div>
                <p class="text-sm mt-8 md:mt-0">&copy; 2026 ALS PeriodECHO - SDO Pangasinan II. All Rights Reserved.</p>
                <a id="footer-login-link" href="login.html" class="text-slate-400 hover:text-white text-xs underline mt-2 block">Admin Login</a>
                <span id="admin-controls" style="display: none;"><button onclick="window.toggleAdmin()" class="bg-red-500 hover:bg-red-600 text-white text-xs px-3 py-1 rounded mt-2">Logout</button></span>
            </div>
        </div>
    </footer>

    <div id="post-form-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 id="form-modal-title" class="text-xl font-bold dark:text-white">Write New Story</h3>
                <button onclick="window.closePostForm()" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            <form id="new-post-form" onsubmit="window.submitPost(event)" class="p-6 space-y-4">
                <div><label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Title</label><input type="text" id="post-title" required class="w-full px-4 py-2 rounded-lg border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Category</label>
                        <select id="post-category" class="w-full px-4 py-2 rounded-lg border dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            <option value="Headline">Headline</option>
                            <option value="News">News</option>
                            <option value="Lifestyle/Feature">Lifestyle/Feature</option>
                            <option value="Editorial">Editorial</option>
                            <option value="Sports and Health">Sports and Health</option>
                            <option value="Science and Technology">Science and Technology</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Livelihood">Livelihood</option>
                            <option value="Success Stories">Success Stories</option>
                            <option value="Literature">Literature</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Gallery Images (Max 4)</label>
                        <div class="flex space-x-4 mb-2 text-sm">
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="post-img-source" value="url" checked onclick="toggleImageSource('url', 'post')" class="accent-als-teal"><span class="dark:text-slate-300">Link</span></label>
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="post-img-source" value="upload" onclick="toggleImageSource('upload', 'post')" class="accent-als-teal"><span class="dark:text-slate-300">Upload</span></label>
                        </div>
                        
                        <div class="flex gap-2">
                             <input type="url" id="post-img-input-url" placeholder="https://..." class="flex-1 px-3 py-1.5 text-sm rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                             <input type="file" id="post-img-input-file" accept="image/*" multiple class="hidden flex-1 text-sm text-slate-500 file:mr-4 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-als-teal file:text-white hover:file:bg-als-navy">
                             <button type="button" onclick="window.handleAddImage()" class="px-4 py-1.5 bg-als-teal text-white text-xs font-bold rounded hover:bg-als-navy transition-colors"><i class="fas fa-plus"></i> Add</button>
                        </div>
                        <p id="image-limit-msg" class="text-[10px] text-red-500 mt-1 hidden">Maximum 4 images allowed.</p>
                        
                        <div id="image-manager-list" class="grid grid-cols-4 gap-2 mt-3"></div>
                    </div>
                </div>
                <div><label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Excerpt</label><textarea id="post-excerpt" rows="2" class="w-full px-4 py-2 rounded-lg border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></textarea></div>
                <div><label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1">Content</label><textarea id="post-content" required rows="6" class="w-full px-4 py-2 rounded-lg border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></textarea></div>
                <div class="pt-4 flex justify-end gap-3"><button type="button" onclick="window.closePostForm()" class="px-6 py-2 rounded-full text-slate-600">Cancel</button><button type="submit" id="form-submit-btn" class="px-8 py-2 bg-als-yellow text-als-navy font-bold rounded-full">Publish</button></div>
            </form>
        </div>
    </div>

    <div id="branding-form-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center"><h3 class="text-xl font-bold dark:text-white">Site Branding</h3><button onclick="window.closeBrandingForm()" class="text-slate-400"><i class="fas fa-times text-xl"></i></button></div>
            <form id="branding-form" onsubmit="window.submitBranding(event)" class="p-6 space-y-6 overflow-y-auto text-sm">
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3">Header (Top Bar)</label>
                    <div class="flex gap-4 mb-4">
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" id="brand-type-standard" name="branding-type" value="standard" onchange="toggleBrandingInputs()" class="accent-als-teal"><span class="font-semibold dark:text-slate-200">Logo + Text</span></label>
                        <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" id="brand-type-banner" name="branding-type" value="banner" onchange="toggleBrandingInputs()" class="accent-als-teal"><span class="font-semibold dark:text-slate-200">Full Banner</span></label>
                    </div>
                    <div id="branding-standard-section" class="space-y-3 transition-opacity">
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="block mb-1 font-bold dark:text-slate-300">Site Name</label><input type="text" id="brand-title-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                            <div><label class="block mb-1 font-bold dark:text-slate-300">Subtitle</label><input type="text" id="brand-subtitle-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                        </div>
                        <div><label class="block mb-1 font-bold dark:text-slate-300">Motto / Tagline</label><input type="text" id="brand-tagline-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                        <div class="pt-2">
                            <label class="block mb-1 font-bold dark:text-slate-300">Logo Image</label>
                            <div class="flex items-center gap-2 mb-2">
                                <label class="cursor-pointer"><input type="radio" name="logo-img-source" value="url" checked onclick="toggleImageSource('url', 'logo')" class="accent-als-teal mr-1">Link</label>
                                <label class="cursor-pointer"><input type="radio" name="logo-img-source" value="upload" onclick="toggleImageSource('upload', 'logo')" class="accent-als-teal mr-1">Upload</label>
                            </div>
                            <input type="url" id="logo-img-input-url" placeholder="https://..." oninput="updateUrlValue(this, 'logo-image')" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            <div id="logo-drop-zone" class="hidden border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-3 text-center cursor-pointer hover:border-als-teal transition-colors relative" ondragover="window.handleDragOver(event)" ondragleave="window.handleDragLeave(event)" ondrop="window.handleDrop(event, 'logo-img-input-file', 'logo-image')" onclick="document.getElementById('logo-img-input-file').click()">
                                <p class="text-xs text-slate-500">Drag or click to upload</p><input type="file" id="logo-img-input-file" accept="image/*" onchange="processImageUpload(this, 'logo-image')" class="hidden">
                            </div>
                            <input type="hidden" id="logo-image">
                        </div>
                    </div>
                    <div id="branding-banner-section" class="space-y-3 hidden transition-opacity">
                        <label class="block mb-1 font-bold dark:text-slate-300">Banner Image</label>
                        <div class="flex items-center gap-2 mb-2">
                            <label class="cursor-pointer"><input type="radio" name="banner-img-source" value="url" checked onclick="toggleImageSource('url', 'banner')" class="accent-als-teal mr-1">Link</label>
                            <label class="cursor-pointer"><input type="radio" name="banner-img-source" value="upload" onclick="toggleImageSource('upload', 'banner')" class="accent-als-teal mr-1">Upload</label>
                        </div>
                        <input type="url" id="banner-img-input-url" placeholder="https://..." oninput="updateUrlValue(this, 'banner-image')" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                        <div id="banner-drop-zone" class="hidden border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-3 text-center cursor-pointer hover:border-als-teal transition-colors relative" ondragover="window.handleDragOver(event)" ondragleave="window.handleDragLeave(event)" ondrop="window.handleDrop(event, 'banner-img-input-file', 'banner-image')" onclick="document.getElementById('banner-img-input-file').click()">
                            <p class="text-xs text-slate-500">Drag or click to upload</p><input type="file" id="banner-img-input-file" accept="image/*" onchange="processImageUpload(this, 'banner-image')" class="hidden">
                        </div>
                        <input type="hidden" id="banner-image">
                    </div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3">Hero / Welcome Section</label>
                    <label class="flex items-center space-x-2 cursor-pointer mb-4"><input type="checkbox" id="brand-static-hero" onchange="toggleHeroInputs()" class="w-4 h-4 accent-als-teal rounded"><span class="font-bold dark:text-slate-200">Enable Static Welcome Section</span></label>
                    <div id="branding-hero-section" class="space-y-3 opacity-50 pointer-events-none transition-opacity">
                        <div>
                            <label class="block mb-1 font-bold dark:text-slate-300">Welcome Image (Right Side)</label>
                            <div class="flex items-center gap-2 mb-2">
                                <label class="cursor-pointer"><input type="radio" name="hero-img-source" value="url" checked onclick="toggleImageSource('url', 'hero')" class="accent-als-teal mr-1">Link</label>
                                <label class="cursor-pointer"><input type="radio" name="hero-img-source" value="upload" onclick="toggleImageSource('upload', 'hero')" class="accent-als-teal mr-1">Upload</label>
                            </div>
                            <input type="url" id="hero-img-input-url" placeholder="https://..." oninput="updateUrlValue(this, 'hero-image-input')" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            <div id="hero-drop-zone" class="hidden border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-3 text-center cursor-pointer hover:border-als-teal transition-colors relative" ondragover="window.handleDragOver(event)" ondragleave="window.handleDragLeave(event)" ondrop="window.handleDrop(event, 'hero-img-input-file', 'hero-image-input')" onclick="document.getElementById('hero-img-input-file').click()">
                                <p class="text-xs text-slate-500">Drag or click to upload</p><input type="file" id="hero-img-input-file" accept="image/*" onchange="processImageUpload(this, 'hero-image-input')" class="hidden">
                            </div>
                            <input type="hidden" id="hero-image-input">
                        </div>
                        <div><label class="block mb-1 font-bold dark:text-slate-300">Welcome Message</label><textarea id="brand-hero-desc" rows="3" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white" placeholder="Your digital platform..."></textarea></div>
                    </div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3">Social Media Links</label>
                    <div class="space-y-3">
                        <div><label class="block mb-1 font-bold dark:text-slate-300">Facebook URL</label><input type="text" id="brand-fb-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white" placeholder="https://facebook.com/..."></div>
                        <div><label class="block mb-1 font-bold dark:text-slate-300">Twitter URL</label><input type="text" id="brand-tw-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                        <div><label class="block mb-1 font-bold dark:text-slate-300">Instagram URL</label><input type="text" id="brand-ig-input" class="w-full px-3 py-2 rounded border dark:border-slate-600 dark:bg-slate-700 dark:text-white"></div>
                    </div>
                </div>
                <div class="pt-2 flex justify-end gap-3"><button type="button" onclick="window.closeBrandingForm()" class="px-6 py-2 rounded-full text-slate-600">Cancel</button><button type="submit" class="px-8 py-2 bg-als-yellow text-als-navy font-bold rounded-full">Save Changes</button></div>
            </form>
        </div>
    </div>

    <div id="article-modal" class="hidden fixed inset-0 z-50 flex justify-center bg-black/90 backdrop-blur-sm overflow-y-auto py-10 px-4">
        <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-3xl h-fit relative">
            <button onclick="window.closeModal()" class="absolute -top-10 right-0 md:-right-10 text-white hover:text-als-yellow transition-colors"><i class="fas fa-times text-2xl"></i></button>
            <div class="h-64 sm:h-[500px] w-full bg-black relative group rounded-t-2xl overflow-hidden">
                <img id="modal-img" src="" class="w-full h-full object-contain transition-opacity duration-300">
                <button id="modal-prev-btn" onclick="window.changeSlide(-1)" class="hidden absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/20 hover:bg-white text-white hover:text-als-navy rounded-full flex items-center justify-center transition-colors"><i class="fas fa-chevron-left"></i></button>
                <button id="modal-next-btn" onclick="window.changeSlide(1)" class="hidden absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/20 hover:bg-white text-white hover:text-als-navy rounded-full flex items-center justify-center transition-colors"><i class="fas fa-chevron-right"></i></button>
                <span id="modal-img-counter" class="hidden absolute top-4 right-4 bg-black/50 text-white text-xs px-2 py-1 rounded-full font-mono">1/1</span>
            </div>
            <div class="px-8 sm:px-12 pt-8">
                <div class="flex items-center justify-between mb-4">
                    <span id="modal-category" class="inline-block py-1 px-3 rounded-full bg-als-yellow text-als-navy text-xs font-bold tracking-wider"></span>
                    <span id="modal-date" class="text-slate-500 text-sm font-medium"></span>
                </div>
                <h2 id="modal-title" class="text-2xl sm:text-4xl font-serif font-bold text-als-navy dark:text-white leading-tight mb-2"></h2>
            </div>
            <div class="px-8 sm:px-12 py-6 flex items-center border-b border-slate-100 dark:border-slate-700">
                <button id="like-btn" class="group flex items-center space-x-2 bg-slate-100 dark:bg-slate-800 hover:bg-red-50 dark:hover:bg-red-900/30 px-4 py-2 rounded-full transition-all border border-slate-200 dark:border-slate-700">
                    <i class="far fa-heart text-xl text-slate-400 group-hover:text-red-500 transition-colors"></i>
                    <span id="like-count" class="font-bold text-slate-600 dark:text-slate-300">0</span>
                </button>
                <span class="ml-3 text-xs text-slate-400 uppercase tracking-wider font-bold">Likes</span>
            </div>
            <div id="modal-content" class="p-8 sm:p-12 prose prose-lg dark:prose-invert max-w-none font-serif text-slate-700 dark:text-slate-300 leading-loose"></div>
            <div class="px-8 sm:px-12 pb-12">
                <button onclick="window.closeModal()" class="w-full sm:w-auto px-8 py-3 bg-slate-100 dark:bg-slate-800 hover:bg-als-teal hover:text-white text-slate-700 dark:text-slate-300 rounded-full font-bold transition-all flex items-center justify-center gap-2"><i class="fas fa-arrow-left"></i> Back to News</button>
            </div>
        </div>
    </div>
</body>
</html>
